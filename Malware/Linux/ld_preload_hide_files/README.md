# Hooking with `LD_PRELOAD` method

## How it works

- `LD_PRELOAD` will load user-specified shared object, libraries... prior to all libraries, therefore our function will be executed first.
- When calling `ls`, it will use `readdir` to read current directory entries, we'll intercept this function to hide our `amogus.txt` file
- Declare a function pointer `orig_readdir` to point to `readdir()` <br>
![image](https://github.com/newball2814/system-programming/assets/35733326/81966ed5-1739-49c0-862e-27093018b559)
- Use `dlsym()` to dynamically load `readdir()` symbol, with flag `RTDL_NEXT` now `orig_readdir` points to `readdir()`
![image](https://github.com/newball2814/system-programming/assets/35733326/22daf130-ca25-4122-93a5-43396d023c20)
- Redefine `readdir` function, this is our hooked function. Inside we call `orig_readdir()`, iterate through all entries, exclude entries with `amogus.txt`, then print out other entries' name.
![image](https://github.com/newball2814/system-programming/assets/35733326/3248221c-e02c-4228-b141-8a552304b33d)

## Build instruction
`$ make`

## Demo

https://github.com/newball2814/system-programming/assets/35733326/933d96f4-0bfc-4734-a885-a8e610758ed3
